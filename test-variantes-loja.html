<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Variantes na Loja - Abratecnica</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: #f5f5f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .debug-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .test-controls {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .btn {
            background: #e74c3c;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #c0392b;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>🧪 Teste de Variantes na Loja</h1>
            <p>Esta página testa se os seletores de variantes aparecem nas tarjetas de produtos</p>
        </div>

        <div class="test-controls">
            <button class="btn" onclick="testWithSampleData()">Testar com Dados Simulados</button>
            <button class="btn" onclick="testWithRealAPI()">Testar com API Real</button>
            <button class="btn" onclick="clearResults()">Limpar</button>
        </div>

        <div id="debug-info" class="debug-info" style="display: none;"></div>
        
        <div id="products-container" class="products-grid"></div>
    </div>

    <!-- Incluir arquivos necessários -->
    <script src="config.js"></script>
    <script src="script.js"></script>
    
    <script>
        // Dados de teste que simulam a resposta da nova API
        const sampleAPIData = [
            {
                id: "disco-abrasivo-grao40",
                name: "Disco Abrasivo 115mm - Grão 40",
                code: "DA115-40",
                price: 25.90,
                currentStock: 10,
                grao: "40",
                diametroExt: "115",
                type: "Disco Abrasivo",
                published: true,
                imageUrl: "https://via.placeholder.com/350x250/e74c3c/ffffff?text=Disco+Grao+40",
                description: "Disco abrasivo de alta qualidade para desgaste rápido e acabamento superior."
            },
            {
                id: "disco-abrasivo-grao60",
                name: "Disco Abrasivo 115mm - Grão 60", 
                code: "DA115-60",
                price: 27.90,
                currentStock: 15,
                grao: "60",
                diametroExt: "115",
                type: "Disco Abrasivo",
                published: true,
                imageUrl: "https://via.placeholder.com/350x250/e74c3c/ffffff?text=Disco+Grao+60",
                description: "Disco abrasivo de alta qualidade para desgaste médio e acabamento fino."
            },
            {
                id: "disco-abrasivo-grao80",
                name: "Disco Abrasivo 115mm - Grão 80",
                code: "DA115-80", 
                price: 29.90,
                currentStock: 8,
                grao: "80",
                diametroExt: "115",
                type: "Disco Abrasivo",
                published: true,
                imageUrl: "https://via.placeholder.com/350x250/e74c3c/ffffff?text=Disco+Grao+80",
                description: "Disco abrasivo de alta qualidade para acabamento fino e polimento."
            },
            {
                id: "roda-desbaste-125-var1",
                name: "Roda de Desbaste 125mm - Espessura 6mm",
                code: "RD125-6",
                price: 35.90,
                currentStock: 12,
                diametroExt: "125",
                alturaRoda: "6",
                type: "Roda de Desbaste",
                published: true,
                imageUrl: "https://via.placeholder.com/350x250/27ae60/ffffff?text=Roda+125x6",
                description: "Roda de desbaste para trabalhos pesados em metais ferrosos."
            },
            {
                id: "roda-desbaste-125-var2",
                name: "Roda de Desbaste 125mm - Espessura 8mm",
                code: "RD125-8",
                price: 38.90,
                currentStock: 8,
                diametroExt: "125",
                alturaRoda: "8",
                type: "Roda de Desbaste",
                published: true,
                imageUrl: "https://via.placeholder.com/350x250/27ae60/ffffff?text=Roda+125x8",
                description: "Roda de desbaste de maior espessura para trabalhos mais intensivos."
            },
            {
                id: "lixa-simples",
                name: "Lixa para Madeira P120",
                code: "LM-P120",
                price: 5.90,
                currentStock: 50,
                type: "Lixa",
                published: true,
                imageUrl: "https://via.placeholder.com/350x250/3498db/ffffff?text=Lixa+P120",
                description: "Lixa de papel para acabamento em madeira."
            }
        ];

        function testWithSampleData() {
            const debugDiv = document.getElementById('debug-info');
            const productsContainer = document.getElementById('products-container');
            
            debugDiv.style.display = 'block';
            debugDiv.innerHTML = '🔄 Processando dados de teste...\n\n';
            
            console.log('=== INICIANDO TESTE COM DADOS SIMULADOS ===');
            console.log('Dados originais:', sampleAPIData);
            
            // Agrupar produtos usando a função do script.js
            const groupedProducts = groupProductsByBase(sampleAPIData);
            
            debugDiv.innerHTML += `✅ Agrupamento concluído:\n`;
            debugDiv.innerHTML += `   - Produtos originais: ${sampleAPIData.length}\n`;
            debugDiv.innerHTML += `   - Produtos agrupados: ${groupedProducts.length}\n\n`;
            
            // Mostrar detalhes de cada produto agrupado
            groupedProducts.forEach((product, index) => {
                debugDiv.innerHTML += `${index + 1}. ${product.name}\n`;
                debugDiv.innerHTML += `   ID: ${product.id}\n`;
                debugDiv.innerHTML += `   Variantes: ${product.variants ? product.variants.length : 0}\n`;
                
                if (product.variants && product.variants.length > 0) {
                    product.variants.forEach(variant => {
                        debugDiv.innerHTML += `     - ${variant.value} (${variant.sku}) - R$ ${variant.price}\n`;
                    });
                }
                debugDiv.innerHTML += '\n';
            });
            
            // Criar tarjetas de produtos
            productsContainer.innerHTML = '';
            groupedProducts.forEach(product => {
                const productCard = createShopProductCard(product);
                productsContainer.appendChild(productCard);
            });
            
            debugDiv.innerHTML += '🎯 Tarjetas de produtos criadas!\n';
            debugDiv.innerHTML += '👆 Verifique se os seletores de variantes aparecem nas tarjetas acima.\n';
        }

        async function testWithRealAPI() {
            const debugDiv = document.getElementById('debug-info');
            const productsContainer = document.getElementById('products-container');
            
            debugDiv.style.display = 'block';
            debugDiv.innerHTML = '🔄 Conectando com API real...\n\n';
            
            try {
                const products = await window.apiRequest(API_CONFIG.ENDPOINTS.PRODUCTS);
                
                debugDiv.innerHTML += `✅ API conectada com sucesso!\n`;
                debugDiv.innerHTML += `   - Total de produtos: ${products.length}\n\n`;
                
                // Agrupar produtos
                const groupedProducts = groupProductsByBase(products);
                
                debugDiv.innerHTML += `📦 Produtos agrupados: ${groupedProducts.length}\n`;
                
                // Mostrar produtos com variantes
                const withVariants = groupedProducts.filter(p => p.variants && p.variants.length > 0);
                debugDiv.innerHTML += `🎯 Produtos com variantes: ${withVariants.length}\n\n`;
                
                if (withVariants.length > 0) {
                    debugDiv.innerHTML += 'Produtos com variantes:\n';
                    withVariants.forEach((product, index) => {
                        debugDiv.innerHTML += `${index + 1}. ${product.name} (${product.variants.length} variantes)\n`;
                    });
                }
                
                // Criar tarjetas
                productsContainer.innerHTML = '';
                
                // Mostrar apenas primeiros 6 produtos para não sobrecarregar
                const productsToShow = groupedProducts.slice(0, 6);
                productsToShow.forEach(product => {
                    const productCard = createShopProductCard(product);
                    productsContainer.appendChild(productCard);
                });
                
                debugDiv.innerHTML += '\n🎨 Tarjetas criadas com dados reais!\n';
                
            } catch (error) {
                debugDiv.innerHTML += `❌ Erro na API: ${error.message}\n`;
                console.error('Erro na API:', error);
            }
        }

        function clearResults() {
            document.getElementById('debug-info').style.display = 'none';
            document.getElementById('products-container').innerHTML = '';
        }

        // Inicializar automaticamente com dados de teste
        window.addEventListener('load', () => {
            setTimeout(() => {
                testWithSampleData();
            }, 500);
        });
    </script>
</body>
</html>