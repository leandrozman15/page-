# CONFIGURACIÓN APACHE PARA LOCAWEB - ABRATECNICA
# Archivo: .htaccess
# Ubicación: public_html/.htaccess

# ========================================
# REDIRECCIÓN HTTPS (OBLIGATORIO)
# ========================================
RewriteEngine On
DirectoryIndex index.html index.htm
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# ========================================
# REDIRECCIÓN WWW (OPCIONAL)
# ========================================
RewriteCond %{HTTP_HOST} ^www\.abratecnica\.com\.br [NC]
RewriteRule ^(.*)$ https://abratecnica.com.br/$1 [L,R=301]

# ========================================
# COMPRESIÓN GZIP (MEJORA VELOCIDAD)
# ========================================
<IfModule mod_deflate.c>
    # Comprimir archivos de texto
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# ========================================
# CACHE DE ARCHIVOS ESTÁTICOS
# ========================================
<IfModule mod_expires.c>
    ExpiresActive On
    
    # Imágenes
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/webp "access plus 1 month"
    
    # CSS y JavaScript
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/x-javascript "access plus 1 month"
    
    # Íconos
    ExpiresByType image/x-icon "access plus 1 year"
</IfModule>

# ========================================
# SEGURIDAD - PROTEGER ARCHIVOS
# ========================================

# Bloquear acceso a archivos de configuración
<Files ~ "^\.">
Order allow,deny
Deny from all
</Files>

# Bloquear acceso a archivos sensibles (permitir config.js para frontend)
<FilesMatch "(\.bat|\.txt)$">
Order allow,deny
Deny from all
</FilesMatch>

# Permitir archivos web necesarios (incluye PHP para API)
<FilesMatch "\.(html|css|js|png|jpg|jpeg|gif|webp|svg|ico|pdf|woff|woff2|ttf|eot|php)$">
Order allow,deny
Allow from all
</FilesMatch>

# ========================================
# PÁGINAS DE ERROR PERSONALIZADAS
# ========================================
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html

# ========================================
# CONFIGURACIÓN PARA SPA (Single Page App)
# ========================================
# Si el archivo no existe, sirve index.html (para rutas del frontend)
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /
    
    # Servir archivos existentes directamente
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]
    
    # Para rutas que no existen, servir index.html
    # RewriteRule ^ index.html [L]
</IfModule>

# ========================================
# CONFIGURACIÓN CORS PARA FIREBASE
# ========================================
<IfModule mod_headers.c>
    # Permitir CORS para Firebase
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
    
    # Responder a requests OPTIONS
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
</IfModule>