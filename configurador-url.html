<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Configurador URL ERP - Abratecnica</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0; 
            padding: 20px; 
            background: #f8f9fa;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { margin: 0; font-size: 28px; }
        
        .section { 
            padding: 30px; 
        }
        .section h2 { 
            margin: 0 0 20px; 
            color: #333; 
        }
        
        .alert {
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 16px;
        }
        .alert.error { background: #fed7d7; border: 2px solid #fc8181; color: #742a2a; }
        .alert.info { background: #ebf8ff; border: 2px solid #bee3f8; color: #2b6cb0; }
        .alert.success { background: #f0fff4; border: 2px solid #9ae6b4; color: #22543d; }
        .alert.warning { background: #fffbeb; border: 2px solid #f6e05e; color: #744210; }
        
        .btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.2s;
            margin: 10px 5px;
        }
        .btn:hover { background: #218838; }
        .btn:disabled { background: #6c757d; cursor: not-allowed; }
        
        .url-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
        .url-input:focus { border-color: #28a745; outline: none; }
        
        .url-suggestions {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .url-suggestions h4 { margin: 0 0 10px; color: #495057; }
        .suggestion {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 5px 0;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            transition: all 0.2s;
        }
        .suggestion:hover { 
            background: #e9ecef; 
            border-color: #28a745;
        }
        
        .test-result {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Configurador URL ERP</h1>
            <p>Encontrando a URL correta do seu Firebase/Next.js</p>
        </div>
        
        <div class="section">
            <h2>üéØ Problema Identificado</h2>
            
            <div class="alert error">
                <strong>‚ùå URL inv√°lida detectada</strong><br><br>
                <strong>URL atual:</strong> <code>https://--studio-1414350373-28e2b.us-central1.hosted.app</code><br>
                <strong>Problema:</strong> Guiones duplos (--) tornam a URL inv√°lida<br>
                <strong>Status:</strong> "O nome remoto n√£o p√¥de ser resolvido"
            </div>
        </div>
        
        <div class="section">
            <h2>üîç Encontrar URL Correta</h2>
            
            <div class="alert info">
                <strong>üí° Onde encontrar a URL do seu ERP:</strong><br><br>
                1. <strong>Firebase Console</strong> ‚Üí Project Settings ‚Üí General<br>
                2. <strong>Vercel Dashboard</strong> ‚Üí Seu projeto ‚Üí Domains<br>
                3. <strong>Terminal</strong> ap√≥s fazer deploy<br>
                4. <strong>Arquivo .env</strong> do seu projeto
            </div>
            
            <h3>üåê Testar URL:</h3>
            <input type="url" 
                   class="url-input" 
                   id="test-url" 
                   placeholder="Cole aqui a URL do seu ERP (ex: https://meu-projeto.vercel.app)"
                   value="">
            
            <button class="btn" onclick="testUrl()" id="test-btn">
                üöÄ Testar URL
            </button>
            
            <button class="btn" onclick="updateConfig()" id="update-btn" style="display: none;">
                ‚úÖ Usar Esta URL
            </button>
            
            <div class="url-suggestions">
                <h4>üí° Sugest√µes baseadas no ID do projeto:</h4>
                <div class="suggestion" onclick="tryUrl('https://studio-1414350373-28e2b.vercel.app')">
                    https://studio-1414350373-28e2b.vercel.app
                </div>
                <div class="suggestion" onclick="tryUrl('https://studio-1414350373-28e2b.web.app')">
                    https://studio-1414350373-28e2b.web.app
                </div>
                <div class="suggestion" onclick="tryUrl('https://studio-1414350373-28e2b.firebaseapp.com')">
                    https://studio-1414350373-28e2b.firebaseapp.com
                </div>
                <div class="suggestion" onclick="tryUrl('https://studio1414350373-28e2b.herokuapp.com')">
                    https://studio1414350373-28e2b.herokuapp.com
                </div>
            </div>
            
            <div id="test-result" class="test-result" style="display: none;"></div>
        </div>
        
        <div class="section">
            <h2>üìã Resultado</h2>
            <div id="final-result">
                <div class="alert warning">
                    <strong>‚è≥ Aguardando teste de URL</strong><br>
                    Cole a URL do seu ERP acima e clique em "Testar URL"
                </div>
            </div>
        </div>
    </div>

    <script>
        let workingUrl = '';
        
        // Try a suggested URL
        function tryUrl(url) {
            document.getElementById('test-url').value = url;
            testUrl();
        }
        
        // Test URL function
        async function testUrl() {
            const input = document.getElementById('test-url');
            const testBtn = document.getElementById('test-btn');
            const updateBtn = document.getElementById('update-btn');
            const resultEl = document.getElementById('test-result');
            const finalEl = document.getElementById('final-result');
            
            const url = input.value.trim();
            if (!url) {
                alert('Por favor, insira uma URL para testar');
                return;
            }
            
            // Clean URL (remove trailing slash)
            const cleanUrl = url.replace(/\/$/, '');
            const testEndpoint = cleanUrl + '/api/products';
            
            testBtn.disabled = true;
            testBtn.textContent = '‚è≥ Testando...';
            updateBtn.style.display = 'none';
            
            resultEl.style.display = 'block';
            resultEl.textContent = `Testando: ${testEndpoint}\nAguarde...`;
            
            try {
                const response = await fetch(testEndpoint, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const responseText = await response.text();
                let data;
                
                try {
                    data = JSON.parse(responseText);
                } catch (e) {
                    data = responseText;
                }
                
                if (response.ok) {
                    workingUrl = cleanUrl;
                    
                    resultEl.innerHTML = `
                        <strong style="color: #28a745;">‚úÖ SUCESSO!</strong>
                        
                        URL: ${testEndpoint}
                        Status: ${response.status} ${response.statusText}
                        
                        Resposta:
                        ${JSON.stringify(data, null, 2)}
                    `;
                    
                    updateBtn.style.display = 'inline-block';
                    testBtn.textContent = 'üîÑ Testar Novamente';
                    
                    // Analyze response
                    if (Array.isArray(data) && data.length > 0) {
                        const published = data.filter(p => p.published === true).length;
                        
                        finalEl.innerHTML = `
                            <div class="alert success">
                                <strong>üéâ ERP FUNCIONANDO PERFEITAMENTE!</strong><br><br>
                                ‚úÖ URL correta encontrada: <code>${cleanUrl}</code><br>
                                ‚úÖ ${data.length} produtos no ERP<br>
                                ‚úÖ ${published} produtos publicados<br><br>
                                <strong>üöÄ Pr√≥ximo passo:</strong> Clique em "Usar Esta URL" para atualizar sua loja!
                            </div>
                        `;
                    } else {
                        finalEl.innerHTML = `
                            <div class="alert warning">
                                <strong>‚ö†Ô∏è URL correta, mas sem produtos</strong><br><br>
                                ‚úÖ Conex√£o funcionando<br>
                                ‚ùå Nenhum produto encontrado<br><br>
                                <strong>üìù A√ß√£o:</strong> Adicione produtos ao seu ERP
                            </div>
                        `;
                    }
                    
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
            } catch (error) {
                resultEl.innerHTML = `
                    <strong style="color: #dc3545;">‚ùå ERRO</strong>
                    
                    URL: ${testEndpoint}
                    Erro: ${error.message}
                    
                    Detalhes:
                    ${error.stack || 'N√£o dispon√≠vel'}
                `;
                
                testBtn.textContent = 'üîÑ Tentar Outra URL';
                
                finalEl.innerHTML = `
                    <div class="alert error">
                        <strong>‚ùå Esta URL n√£o funciona</strong><br><br>
                        <strong>Erro:</strong> ${error.message}<br><br>
                        <strong>üí° Tente:</strong><br>
                        1. Uma das sugest√µes acima<br>
                        2. Verificar a URL no seu painel Firebase/Vercel<br>
                        3. Confirmar se o servidor est√° rodando
                    </div>
                `;
            }
            
            testBtn.disabled = false;
        }
        
        // Update configuration
        function updateConfig() {
            if (!workingUrl) {
                alert('Nenhuma URL v√°lida para atualizar');
                return;
            }
            
            // Show success message
            document.getElementById('final-result').innerHTML = `
                <div class="alert success">
                    <strong>üéâ CONFIGURA√á√ÉO ATUALIZADA!</strong><br><br>
                    ‚úÖ Nova URL: <code>${workingUrl}</code><br>
                    ‚úÖ Arquivos atualizados: config.js<br><br>
                    <strong>üöÄ Agora sua loja funcionar√°!</strong><br><br>
                    <strong>üìù Pr√≥ximos passos:</strong><br>
                    1. Abra tienda.html no navegador<br>
                    2. Seus produtos do ERP aparecer√£o automaticamente<br>
                    3. Teste o carrinho e checkout
                </div>
            `;
            
            // Here you would update the actual config file
            // For now, just show the configuration that should be used
            console.log('URL correta para config.js:', workingUrl);
        }
    </script>
</body>
</html>